(()=>{"use strict";var e=function(e,t,i,r){return new(i||(i=Promise))((function(n,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,o)}u((r=r.apply(e,t||[])).next())}))};class t{initialize(t,i){return e(this,void 0,void 0,(function*(){const e=yield fetch(i),r=yield e.blob(),n=yield createImageBitmap(r);yield this.loadImageBitmap(t,n),this.view=this.texture.createView({format:"rgba8unorm",dimension:"2d",aspect:"all",baseMipLevel:0,mipLevelCount:1,baseArrayLayer:0,arrayLayerCount:1}),this.sampler=t.createSampler({addressModeU:"repeat",addressModeV:"repeat",magFilter:"linear",minFilter:"nearest",mipmapFilter:"nearest",maxAnisotropy:1})}))}loadImageBitmap(t,i){return e(this,void 0,void 0,(function*(){const e={size:{width:i.width,height:i.height},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT};this.texture=t.createTexture(e),t.queue.copyExternalImageToTexture({source:i},{texture:this.texture},e.size)}))}}const i="struct TransformData {\r\n    model: mat4x4<f32>,\r\n    view: mat4x4<f32>,\r\n    projection: mat4x4<f32>,\r\n};\r\n@binding(0) @group(0) var<uniform> transformUBO: TransformData;\r\n@binding(1) @group(0) var myTexture: texture_2d<f32>;\r\n@binding(2) @group(0) var mySampler: sampler;\r\n\r\nstruct Fragment {\r\n    @builtin(position) Position : vec4<f32>,\r\n    @location(0) TexCoord : vec2<f32>\r\n};\r\n\r\n@vertex\r\nfn vs_main(\r\n    @location(0) vertexPostion: vec3<f32>, \r\n    @location(1) vertexTexCoord: vec2<f32>) -> Fragment \r\n    {\r\n\r\n    var output : Fragment;\r\n    output.Position = transformUBO.projection * transformUBO.view * transformUBO.model * vec4<f32>(vertexPostion, 1.0);\r\n    output.TexCoord = vertexTexCoord;\r\n\r\n    return output;\r\n}\r\n\r\n@fragment\r\nfn fs_main(@location(0) TexCoord : vec2<f32>) -> @location(0) vec4<f32> {\r\n    return textureSample(myTexture, mySampler, TexCoord);\r\n}";class r{constructor(e){const t=new Float32Array([0,0,1,0,1,1,0,1,1,1,1,1,1,1,0,0,1,1,0,0,0,0,0,0,1,1,0,0,1,1,1,1,0,1,0,0,1,0,0,0,0,1,1,0,1,1,1,1,1,1,1,1,0,1,0,0,1,0,0,0,0,0,1,0,1,1,0,1,1,1,1,0,0,1,0,0,0,0,0,0,1,0,1,0,1,1,0,0,1,1,1,1,0,1,0,1,1,1,0,0,0,0,1,0,1,0,0,0,1,1,0,1,0,1,0,0,1,1,0,0]),i=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,r={size:t.byteLength,usage:i,mappedAtCreation:!0};this.buffer=e.createBuffer(r),new Float32Array(this.buffer.getMappedRange()).set(t),this.buffer.unmap(),this.bufferLayout={arrayStride:20,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x2",offset:12}]},this.createIndexBuffer(e)}createIndexBuffer(e){const t=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]);this.indexBuffer=e.createBuffer({size:t.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0}),new Uint16Array(this.indexBuffer.getMappedRange()).set(t),this.indexBuffer.unmap()}}var n=1e-6,a="undefined"!=typeof Float32Array?Float32Array:Array;function s(){var e=new a(16);return a!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var o=function(e,t,i,r){return new(i||(i=Promise))((function(n,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,o)}u((r=r.apply(e,t||[])).next())}))};const u=document.getElementById("gfx-main"),h=new class{constructor(e){this.render=()=>{this.rotationSpeed+=.003,this.rotationSpeed>2*Math.PI&&(this.rotationSpeed-=2*Math.PI);const e=s();!function(e,t,i,r,n){var a,s=1/Math.tan(t/2);e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(a=1/(r-n),e[10]=(n+r)*a,e[14]=2*n*r*a):(e[10]=-1,e[14]=-2*r)}(e,this.degreesToRadians(45),800/600,.1,10);const t=s();var i,r,a,o,u,h,d,c,f,l,p,m,v,g,y,x,b,B,T,S,M,P,w;i=t,y=(r=[0,2,4])[0],x=r[1],b=r[2],B=(o=[0,1,0])[0],T=o[1],S=o[2],M=(a=[0,0,0])[0],P=a[1],w=a[2],Math.abs(y-M)<n&&Math.abs(x-P)<n&&Math.abs(b-w)<n?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(i):(p=y-M,m=x-P,v=b-w,u=T*(v*=g=1/Math.hypot(p,m,v))-S*(m*=g),h=S*(p*=g)-B*v,d=B*m-T*p,(g=Math.hypot(u,h,d))?(u*=g=1/g,h*=g,d*=g):(u=0,h=0,d=0),c=m*d-v*h,f=v*u-p*d,l=p*h-m*u,(g=Math.hypot(c,f,l))?(c*=g=1/g,f*=g,l*=g):(c=0,f=0,l=0),i[0]=u,i[1]=c,i[2]=p,i[3]=0,i[4]=h,i[5]=f,i[6]=m,i[7]=0,i[8]=d,i[9]=l,i[10]=v,i[11]=0,i[12]=-(u*y+h*x+d*b),i[13]=-(c*y+f*x+l*b),i[14]=-(p*y+m*x+v*b),i[15]=1);const U=s();!function(e,t,i,r){var a,s,o,u,h,d,c,f,l,p,m,v,g,y,x,b,B,T,S,M,P,w,U,A,G=r[0],C=r[1],E=r[2],I=Math.hypot(G,C,E);I<n||(G*=I=1/I,C*=I,E*=I,a=Math.sin(i),o=1-(s=Math.cos(i)),u=t[0],h=t[1],d=t[2],c=t[3],f=t[4],l=t[5],p=t[6],m=t[7],v=t[8],g=t[9],y=t[10],x=t[11],b=G*G*o+s,B=C*G*o+E*a,T=E*G*o-C*a,S=G*C*o-E*a,M=C*C*o+s,P=E*C*o+G*a,w=G*E*o+C*a,U=C*E*o-G*a,A=E*E*o+s,e[0]=u*b+f*B+v*T,e[1]=h*b+l*B+g*T,e[2]=d*b+p*B+y*T,e[3]=c*b+m*B+x*T,e[4]=u*S+f*M+v*P,e[5]=h*S+l*M+g*P,e[6]=d*S+p*M+y*P,e[7]=c*S+m*M+x*P,e[8]=u*w+f*U+v*A,e[9]=h*w+l*U+g*A,e[10]=d*w+p*U+y*A,e[11]=c*w+m*U+x*A,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}(U,U,this.rotationSpeed,[0,1,1]),this.device.queue.writeBuffer(this.uniformBuffer,0,U),this.device.queue.writeBuffer(this.uniformBuffer,64,t),this.device.queue.writeBuffer(this.uniformBuffer,128,e);const A=this.device.createCommandEncoder(),G=this.context.getCurrentTexture().createView(),C=A.beginRenderPass({colorAttachments:[{view:G,clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:this.depthStencilAttachment});C.setPipeline(this.pipeline),C.setVertexBuffer(0,this.triangleMesh.buffer),C.setIndexBuffer(this.triangleMesh.indexBuffer,"uint16"),C.setBindGroup(0,this.bindGroup),C.drawIndexed(36),C.end(),this.device.queue.submit([A.finish()]),requestAnimationFrame(this.render)},this.canvas=e,this.rotationSpeed=0}Initialize(){return o(this,void 0,void 0,(function*(){yield this.setupDevice(),yield this.createAssets(),yield this.makeDepthBufferResource(),yield this.makePipeline(),this.render()}))}setupDevice(){var e,t;return o(this,void 0,void 0,(function*(){this.adapter=yield null===(e=navigator.gpu)||void 0===e?void 0:e.requestAdapter(),this.device=yield null===(t=this.adapter)||void 0===t?void 0:t.requestDevice(),this.context=this.canvas.getContext("webgpu"),this.format="bgra8unorm",this.context.configure({device:this.device,format:this.format,alphaMode:"opaque"})}))}makeDepthBufferResource(){return o(this,void 0,void 0,(function*(){this.depthStencilState={format:"depth24plus-stencil8",depthWriteEnabled:!0,depthCompare:"less-equal"};const e={size:{width:this.canvas.width,height:this.canvas.height,depthOrArrayLayers:1},format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT};this.depthStencilBuffer=this.device.createTexture(e),this.depthStencilView=this.depthStencilBuffer.createView({format:"depth24plus-stencil8",dimension:"2d",aspect:"all"}),this.depthStencilAttachment={view:this.depthStencilView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store",stencilLoadOp:"clear",stencilStoreOp:"discard"}}))}makePipeline(){return o(this,void 0,void 0,(function*(){this.uniformBuffer=this.device.createBuffer({size:192,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const e=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]});this.bindGroup=this.device.createBindGroup({layout:e,entries:[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:this.material.view},{binding:2,resource:this.material.sampler}]});const t=this.device.createPipelineLayout({bindGroupLayouts:[e]});this.pipeline=this.device.createRenderPipeline({vertex:{module:this.device.createShaderModule({code:i}),entryPoint:"vs_main",buffers:[this.triangleMesh.bufferLayout]},fragment:{module:this.device.createShaderModule({code:i}),entryPoint:"fs_main",targets:[{format:this.format}]},primitive:{topology:"triangle-list"},layout:t,depthStencil:this.depthStencilState})}))}createAssets(){return o(this,void 0,void 0,(function*(){this.triangleMesh=new r(this.device),this.material=new t,yield this.material.initialize(this.device,"dist/img/ice.jpg")}))}degreesToRadians(e){return e*(Math.PI/180)}}(u);h.Initialize()})();